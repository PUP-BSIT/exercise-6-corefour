<div class="form-container">
  <form [formGroup]="todoForm">

    <label for="taskName">Task Name:</label>
    <input
        id="taskName"
        formControlName="taskName"
        type="text"
        placeholder="e.g. Complete Final Project" />

    @if(taskNameControl.touched && taskNameControl.errors?.['required']) {
      <span class="error">Task Name is required</span>
    }
    @if(taskNameControl.touched && taskNameControl.errors?.['minTaskLength']) {
      <span class="error">{{ taskNameControl.errors?.['minTaskLength'] }}</span>
    }

    <fieldset [formGroup]="classDetailsControl">
      <legend>Class Details:</legend>
      
      <label for="className">Class:</label>
      <select id="className" formControlName="className">
        <option value="">--Select Class--</option>
        @for(class of classOptions; track class) {
          <option [value]="class">{{ class }}</option>
        }
      </select>
      @if(classNameControl.touched && classNameControl.errors?.['required']) {
        <span class="error">Class is required</span>
      }

      <label for="status">Status:</label>
      <select id="status" formControlName="status">
        <option value="">--Select Status--</option>
        @for(status of statusOptions; track status) {
          <option [value]="status">{{ status }}</option>
        }
      </select>
      @if(statusControl.touched && statusControl.errors?.['required']) {
        <span class="error">Status is required</span>
      }
    </fieldset>

    <label for="deadline">Deadline:</label>
    <input id="deadline" formControlName="deadline" type="date" />
    @if(deadlineControl.touched && deadlineControl.errors?.['required']) {
      <span class="error">Deadline is required</span>
    }

    <button type="button" (click)="handleAdd()">ADD TASK</button>
  </form>
</div>

<div class="entry-list">
  <h2>Task List</h2>
  <ul>
    @for(entry of entriesSignal(); track entry.taskName) {
      <li class="entry-card" [attr.data-status]="entry.classDetails.status">
        <strong>Task: {{ entry.taskName }} ||</strong> 
        <strong>Due: {{ entry.deadline | date:'shortDate' }} ||</strong>

        <span class="position">{{ entry.classDetails.className }}</span>

        <div class="powers">
          Status:
          @if(entry.classDetails.status === 'Done') { <span>Done!</span> }
          @if(entry.classDetails.status === 'In Progress') { <span>In Progress</span> }
          @if(entry.classDetails.status === 'Not Started') { <span>Not Started</span> }
        </div>
      </li>
    } @empty {
      <p>No academic tasks added. Use the form above to add a new task.</p>
    }
  </ul>
</div>
